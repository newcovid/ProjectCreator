<ui:FluentWindow x:Class="ProjectCreator.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:local="clr-namespace:ProjectCreator"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 mc:Ignorable="d"
                 Title="项目模板创建器"
                 Width="700"
                 Height="650"
                 MinWidth="550"
                 MinHeight="450"
                 WindowStartupLocation="CenterScreen"
                 WindowBackdropType="Mica"
                 ExtendsContentIntoTitleBar="True"
                 WindowCornerPreference="Round"
                 Loaded="Window_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <ui:TitleBar Grid.Row="0"
                     Title="项目模板创建器"
                     Icon="n_alphabet_letter_letters_icon_209046.ico"/>

        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 动态输入项 -->
                <Border Grid.Row="0"
                        BorderThickness="1"
                        BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                        CornerRadius="4"
                        Padding="10"
                        Margin="0,0,0,15">
                    <ScrollViewer MaxHeight="250"
                                  VerticalScrollBarVisibility="Auto">
                        <ItemsControl Name="DynamicInputsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"
                                                              MinWidth="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding Label}"
                                                   VerticalAlignment="Center"
                                                   ToolTip="{Binding Key}"
                                                   Margin="0,0,10,0"/>
                                        <ui:TextBox Grid.Column="1"
                                                    Name="InputTextBox"
                                                    Margin="5,0"
                                                    VerticalAlignment="Center">
                                            <ui:TextBox.Text>
                                                <Binding Path="Value"
                                                         UpdateSourceTrigger="PropertyChanged"/>
                                            </ui:TextBox.Text>
                                        </ui:TextBox>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

                <ui:Button Grid.Row="1"
                           Name="BtnCreate"
                           Content="创建项目"
                           Margin="0,0,0,15"
                           MinHeight="36"
                           FontWeight="Bold"
                           IsDefault="True"
                           Click="BtnCreate_Click"
                           Appearance="Primary"
                           Icon="{ui:SymbolIcon Play24}"/>

                <Expander Grid.Row="2"
                          Margin="0,0,0,15"
                          VerticalAlignment="Top">
                    <Expander.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Settings24"
                                           Margin="0,0,5,0"/>
                            <TextBlock Text="高级配置"/>
                        </StackPanel>
                    </Expander.Header>

                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Row="0"
                                       Grid.Column="0"
                                       Text="模板路径(_T):"
                                       VerticalAlignment="Center"/>
                            <ui:TextBox Grid.Row="0"
                                        Grid.Column="1"
                                        Name="TxtTemplatePath"
                                        Margin="5"
                                        VerticalAlignment="Center"
                                        IsReadOnly="False"/>
                            <ui:Button Grid.Row="0"
                                       Grid.Column="2"
                                       Name="BtnBrowseTemplate"
                                       Content="浏览..."
                                       Margin="5,5,0,5"
                                       Click="BtnBrowseTemplate_Click"
                                       Icon="{ui:SymbolIcon FolderOpen24}"/>

                            <TextBlock Grid.Row="1"
                                       Grid.Column="0"
                                       Text="目标路径(_D):"
                                       VerticalAlignment="Center"/>
                            <ui:TextBox Grid.Row="1"
                                        Grid.Column="1"
                                        Name="TxtTargetPath"
                                        Margin="5"
                                        VerticalAlignment="Center"
                                        IsReadOnly="False"/>
                            <ui:Button Grid.Row="1"
                                       Grid.Column="2"
                                       Name="BtnBrowseTarget"
                                       Content="浏览..."
                                       Margin="5,5,0,5"
                                       Click="BtnBrowseTarget_Click"
                                       Icon="{ui:SymbolIcon FolderOpen24}"/>
                        </Grid>

                        <CheckBox Grid.Row="1"
                                  Name="ChkReplaceReadme"
                                  Margin="0,15,0,15"
                                  Content="替换模板中 README.md 文件内的占位符"
                                  IsChecked="True"
                                  VerticalAlignment="Center"/>

                        <GroupBox Grid.Row="2"
                                  Header="自定义占位符"
                                  Margin="0,0,0,15"
                                  Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0"
                                           TextWrapping="Wrap"
                                           Margin="5,5,5,10"
                                           Foreground="Gray"
                                           FontSize="11">
            在此处配置主界面的输入项。Key 只能包含字母、数字和下划线 (例如: "project_name")。
            Key 将自动转换为 "%project_name%" 占位符。
                                </TextBlock>

                                <Border Grid.Row="1"
                                        BorderThickness="1"
                                        BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                                        CornerRadius="4"
                                        Background="{DynamicResource ApplicationBackgroundBrush}">
                                    <DataGrid Name="ConfigDataGrid"
                                              AutoGenerateColumns="False"
                                              CanUserAddRows="True"
                                              CanUserDeleteRows="True"
                                              MaxHeight="200"
                                              Margin="0"
                                              BorderThickness="0"
                                              GridLinesVisibility="Horizontal"
                                              HorizontalGridLinesBrush="{DynamicResource ControlElevationBorderBrush}"
                                              VerticalGridLinesBrush="{DynamicResource ControlElevationBorderBrush}"
                                              RowBackground="Transparent"
                                              AlternatingRowBackground="{DynamicResource ControlFillColorSecondaryBrush}"
                                              HeadersVisibility="Column"
                                              ItemsSource="{Binding UserPlaceholders}">
                                        <DataGrid.Resources>
                                            <Style TargetType="DataGridColumnHeader">
                                                <Setter Property="Background"
                                                        Value="{DynamicResource ControlFillColorDefaultBrush}"/>
                                                <Setter Property="Padding"
                                                        Value="8,2"/>
                                                <Setter Property="BorderThickness"
                                                        Value="0,0,1,1"/>
                                                <Setter Property="BorderBrush"
                                                        Value="{DynamicResource ControlElevationBorderBrush}"/>
                                            </Style>
                                        </DataGrid.Resources>
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Key (例如: project_name)"
                                                                Binding="{Binding Key}"
                                                                Width="*">
                                                <!-- [修复 D (核心)] 移除 ElementStyle，改用 CellStyle -->
                                                <DataGridTextColumn.CellStyle>
                                                    <Style TargetType="DataGridCell">
                                                        <Setter Property="Padding"
                                                                Value="8,2"/>
                                                        <Setter Property="VerticalAlignment"
                                                                Value="Center"/>
                                                    </Style>
                                                </DataGridTextColumn.CellStyle>
                                            </DataGridTextColumn>
                                            <DataGridTextColumn Header="UI 标签 (例如: 项目名称)"
                                                                Binding="{Binding Label}"
                                                                Width="2*">
                                                <DataGridTextColumn.CellStyle>
                                                    <Style TargetType="DataGridCell">
                                                        <Setter Property="Padding"
                                                                Value="8,2"/>
                                                        <Setter Property="VerticalAlignment"
                                                                Value="Center"/>
                                                    </Style>
                                                </DataGridTextColumn.CellStyle>
                                            </DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Border>
                            </Grid>
                        </GroupBox>

                        <ui:Button Grid.Row="3"
                                   Name="BtnSaveConfig"
                                   Content="保存配置"
                                   Margin="0,0,0,10"
                                   Click="BtnSaveConfig_Click"
                                   HorizontalAlignment="Right"
                                   Icon="{ui:SymbolIcon Save24}"/>
                    </Grid>
                </Expander>

                <TextBlock Grid.Row="3"
                           Name="TxtStatus"
                           Margin="0"
                           TextWrapping="Wrap"
                           Text="准备就绪。"/>
            </Grid>
        </ScrollViewer>
    </Grid>
</ui:FluentWindow>

